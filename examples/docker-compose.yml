services:
  db:
    image: postgres:16
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
      POSTGRES_DB: ainoc
    ports: ["5432:5432"]
    volumes:
      - ./pgdata:/var/lib/postgresql/data

  core:
    build:
      context: ..
      dockerfile: examples/core.Dockerfile
    environment:
      DATABASE_URL: postgresql://postgres:postgres@db:5432/ainoc
      RAW_DIR: /var/lib/ai-noc/raw
      # agent secret mapping:
      AGENT_SECRET__srv-web-01: "CHANGE_ME_long_random_secret"
    ports: ["8080:8080"]
    volumes:
      - ./raw:/var/lib/ai-noc/raw
    depends_on: [db]

